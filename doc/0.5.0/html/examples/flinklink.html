<!DOCTYPE html>
<html  lang="en-us">
  <head>
    <meta  content="text/html; charset=UTF-8"  http-equiv="content-type">
    <title>AMIDST Toolbox 0.5.0 by amidst</title>
    <meta  name="viewport"  content="width=device-width, initial-scale=1">
    <link  rel="stylesheet"  type="text/css"  href="../stylesheets/normalize.css"
       media="screen">
    <link  href="https://fonts.googleapis.com/css?family=Open+Sans:400,700"  rel="stylesheet"
       type="text/css">
    <link  rel="stylesheet"  type="text/css"  href="../stylesheets/stylesheet.css"
       media="screen">
    <link  rel="stylesheet"  type="text/css"  href="../stylesheets/github-light.css"
       media="screen">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </head>
  <body>
    <section  class="page-header">
      <h1  class="project-name">AMIDST Toolbox 0.5.0</h1>
      <h2  class="project-tagline">A Java Toolbox for Analysis of MassIve Data
        STreams using Probabilistic Graphical Models</h2>
      <a  href="https://github.com/amidst/toolbox"  class="btn">View on GitHub</a>
      <a  href="https://github.com/amidst/toolbox/zipball/master"  class="btn">Download
        .zip</a> <a  href="https://github.com/amidst/toolbox/tarball/master"  class="btn">Download
        .tar.gz</a> </section>

    <section  class="main-content">
    <h1 id="sec:flinklink">Flinklink: Code Examples</h1>
<ul>
<li><p><a href="#sec:flinklink:io">Input/output</a></p>
<ul>
<li><p><a href="#sec:flinklink:io:read">Reading data</a></p></li>
<li><p><a href="#sec:flinklink:io:write">Write data</a></p></li>
</ul></li>
<li><p><a href="#sec:flinklink:learning">Parametric Learning</a></p>
<ul>
<li><p><a href="#sec:flinklink:learning:pml">Parallel Maximum Likelihood</a></p></li>
<li><p><a href="#sec:flinklink:learning:dvmp">Distributed Variational Message Pasing</a></p></li>
<li><p><a href="#sec:flinklink:learning:dvi">Distributed VI</a></p></li>
<li><p><a href="#sec:flinklink:learning:svi">Stochastic VI</a></p></li>
</ul></li>
<li><p><a href="#sec:flinklink:ext"> Extensions and applications</a></p>
<ul>
<li><p><a href="#sec:flinklink:ext:models"> Latent variable models with Flink</a></p></li>
<li><p><a href="#sec:flinklink:ext:conceptdrift">Concept drift</a></p></li>
</ul></li>
</ul>
<h2 id="sec:flinklink:io">Input/output</h2>
<h3 id="sec:flinklink:io:read">Reading data</h3>
<p>In this example we show how can we read a dataset using Flink. Note that the process is the same regardless being a single or a distributed file.</p>
<pre><code>package eu.amidst.flinklink.examples.io;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.io.DataFlinkLoader;
import org.apache.flink.api.java.ExecutionEnvironment;

/**
 * Created by rcabanas on 10/06/16.
 */
public class DataStreamLoaderExample {
    public static void main(String[] args) throws Exception {

        //Set the environment variable
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        //Paths to datasets
        String simpleFile = &quot;datasets/simulated/syntheticData.arff&quot;;
        String distriFile = &quot;datasets/simulated/distributed.arff&quot;;

        //Load the data
        DataFlink&lt;DataInstance&gt; dataSimple = DataFlinkLoader.open(env, simpleFile, false);
        DataFlink&lt;DataInstance&gt; dataDistri = DataFlinkLoader.open(env,distriFile, false);

        //Print the data
        dataSimple.getDataSet().print();
        dataDistri.getDataSet().print();

    }
}</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a></p>
<h3 id="sec:flinklink:io:write">Writing data</h3>
<p>Below we generate a random Flink dataset with 1000 instances, 2 discrete variables and 3 continuous ones. The seed used is 1234. Eventually, we save it as a distributed dataset (format ARFF folder).</p>
<pre><code>package eu.amidst.flinklink.examples.io;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.io.DataFlinkWriter;
import eu.amidst.flinklink.core.utils.DataSetGenerator;
import org.apache.flink.api.java.ExecutionEnvironment;

/**
 * Created by rcabanas on 09/06/16.
 */
public class DataStreamWriterExample {
    public static void main(String[] args) throws Exception {

        //Set-up Flink session.
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        //generate a random dataset
        DataFlink&lt;DataInstance&gt; dataFlink = new DataSetGenerator().generate(env,1234,1000,2,3);

        //Saves it as a distributed arff file
        DataFlinkWriter.writeDataToARFFFolder(dataFlink, &quot;datasets/simulated/distributed.arff&quot;);
    }
}


//TODO: Write to standard arff --&gt; convert to datastream??</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a></p>
<h2 id="sec:flinklink:learning">Parametric learning</h2>
<p>Here give examples of the provided algorithms by AMiDST for learning the probability distributions from a Flink data set. For shake of simplicity, we will consider the Naive Bayes DAG structure. Note that the code is almost the same of each of the algoritms, they only differ on the constructor used (e.g. <em>new ParallelMaximumLikelihood()</em>, <em>new dVMP()</em>, etc.)</p>
<h3 id="sec:flinklink:learning:pml">Parallel Maximum Likelihood</h3>
<pre><code>package eu.amidst.flinklink.examples.learning;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.core.models.BayesianNetwork;
import eu.amidst.core.models.DAG;
import eu.amidst.core.utils.DAGGenerator;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.learning.parametric.ParallelMaximumLikelihood;
import eu.amidst.flinklink.core.learning.parametric.ParameterLearningAlgorithm;
import eu.amidst.flinklink.core.utils.DataSetGenerator;
import org.apache.flink.api.java.ExecutionEnvironment;

/**
 * Created by rcabanas on 14/06/16.
 */
public class ParallelMLExample {
    public static void main(String[] args) throws Exception {
        //Set-up Flink session.
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        //generate a random dataset
        DataFlink&lt;DataInstance&gt; dataFlink = new DataSetGenerator().generate(env,1234,1000,5,0);

        //Creates a DAG with the NaiveBayes structure for the random dataset
        DAG dag = DAGGenerator.getNaiveBayesStructure(dataFlink.getAttributes(), &quot;DiscreteVar4&quot;);
        System.out.println(dag.toString());


        //Create the  Learner object
        ParameterLearningAlgorithm learningAlgorithmFlink =
                new ParallelMaximumLikelihood();

        //Learning parameters
        learningAlgorithmFlink.setBatchSize(10);
        learningAlgorithmFlink.setDAG(dag);

        //Initialize the learning process
        learningAlgorithmFlink.initLearning();

        //Learn from the flink data
        learningAlgorithmFlink.updateModel(dataFlink);

        //Print the learnt BN
        BayesianNetwork bn = learningAlgorithmFlink.getLearntBayesianNetwork();
        System.out.println(bn);



    }
}</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a></p>
<h3 id="sec:flinklink:learning:dvmp">Distributed Variational Message Passing</h3>
<pre><code>package eu.amidst.flinklink.examples.learning;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.core.models.BayesianNetwork;
import eu.amidst.core.models.DAG;
import eu.amidst.core.utils.DAGGenerator;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.learning.parametric.ParameterLearningAlgorithm;
import eu.amidst.flinklink.core.learning.parametric.dVMP;
import eu.amidst.flinklink.core.utils.DataSetGenerator;
import org.apache.flink.api.java.ExecutionEnvironment;

/**
 * Created by rcabanas on 14/06/16.
 */
public class dVMPExample {
    public static void main(String[] args) throws Exception {

        //Set-up Flink session.
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        //generate a random dataset
        DataFlink&lt;DataInstance&gt; dataFlink = new DataSetGenerator().generate(env,1234,1000,5,0);

        //Creates a DAG with the NaiveBayes structure for the random dataset
        DAG dag = DAGGenerator.getNaiveBayesStructure(dataFlink.getAttributes(), &quot;DiscreteVar4&quot;);
        System.out.println(dag.toString());


        //Create the  Learner object
        ParameterLearningAlgorithm learningAlgorithmFlink =
                 new dVMP();

        //Learning parameters
        learningAlgorithmFlink.setBatchSize(10);
        learningAlgorithmFlink.setDAG(dag);

        //Initialize the learning process
        learningAlgorithmFlink.initLearning();

        //Learn from the flink data
        learningAlgorithmFlink.updateModel(dataFlink);

        //Print the learnt BN
        BayesianNetwork bn = learningAlgorithmFlink.getLearntBayesianNetwork();
        System.out.println(bn);



    }
}</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a></p>
<h3 id="sec:flinklink:learning:dvi">Distributed VI</h3>
<pre><code>package eu.amidst.flinklink.examples.learning;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.core.models.BayesianNetwork;
import eu.amidst.core.models.DAG;
import eu.amidst.core.utils.DAGGenerator;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.learning.parametric.DistributedVI;
import eu.amidst.flinklink.core.learning.parametric.ParameterLearningAlgorithm;
import eu.amidst.flinklink.core.utils.DataSetGenerator;
import org.apache.flink.api.java.ExecutionEnvironment;

/**
 * Created by rcabanas on 14/06/16.
 */
public class DistributedVIExample {
    public static void main(String[] args) throws Exception {
        //Set-up Flink session.
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        //generate a random dataset
        DataFlink&lt;DataInstance&gt; dataFlink = new DataSetGenerator().generate(env,1234,1000,5,0);

        //Creates a DAG with the NaiveBayes structure for the random dataset
        DAG dag = DAGGenerator.getNaiveBayesStructure(dataFlink.getAttributes(), &quot;DiscreteVar4&quot;);
        System.out.println(dag.toString());


        //Create the  Learner object
        ParameterLearningAlgorithm learningAlgorithmFlink =
                 new DistributedVI();

        //Learning parameters
        learningAlgorithmFlink.setBatchSize(10);
        learningAlgorithmFlink.setDAG(dag);

        //Initialize the learning process
        learningAlgorithmFlink.initLearning();

        //Learn from the flink data
        learningAlgorithmFlink.updateModel(dataFlink);

        //Print the learnt BN
        BayesianNetwork bn = learningAlgorithmFlink.getLearntBayesianNetwork();
        System.out.println(bn);



    }
}</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a></p>
<h3 id="sec:flinklink:learning:svi">Stochastic VI</h3>
<p>An example of the learning algorithm Stochastic VI is given below. Note that two specific parameters must be set, namely the <em>learning factor</em> and the <em>data size</em>.</p>
<pre><code>package eu.amidst.flinklink.examples.learning;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.core.models.BayesianNetwork;
import eu.amidst.core.models.DAG;
import eu.amidst.core.utils.DAGGenerator;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.learning.parametric.ParameterLearningAlgorithm;
import eu.amidst.flinklink.core.learning.parametric.StochasticVI;
import eu.amidst.flinklink.core.utils.DataSetGenerator;
import org.apache.flink.api.java.ExecutionEnvironment;

/**
 * Created by rcabanas on 14/06/16.
 */
public class StochasticVIExample {
    public static void main(String[] args) throws Exception {

        //Set-up Flink session.
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        //generate a random dataset
        DataFlink&lt;DataInstance&gt; dataFlink = new DataSetGenerator().generate(env,1234,1000,5,0);

        //Creates a DAG with the NaiveBayes structure for the random dataset
        DAG dag = DAGGenerator.getNaiveBayesStructure(dataFlink.getAttributes(), &quot;DiscreteVar4&quot;);
        System.out.println(dag.toString());


        //Create the  Learner object
        ParameterLearningAlgorithm learningAlgorithmFlink =
                new StochasticVI();

        //Learning parameters
        learningAlgorithmFlink.setBatchSize(10);
        learningAlgorithmFlink.setDAG(dag);

        //Initialize the learning process
        learningAlgorithmFlink.initLearning();

        //Learn from the flink data
        learningAlgorithmFlink.updateModel(dataFlink);

        //Specific parameters for the algorithm
        ((StochasticVI)learningAlgorithmFlink).setLearningFactor(0.7);
        ((StochasticVI)learningAlgorithmFlink).setDataSetSize(dataFlink.getDataSet().count());


        //Print the learnt BN
        BayesianNetwork bn = learningAlgorithmFlink.getLearntBayesianNetwork();
        System.out.println(bn);



    }
}</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a></p>
<h2 id="sec:flinklink:ext">Extensions and applications</h2>
<h3 id="sec:flinklink:ext:models">Latent variable models with Flink</h3>
<p>The module <em>latent-variable-models</em> contains a large set of classes that allow to easily learn some of the standard models with latent variables. These models can be learnt from not only from local datasets (e.g. a single ARFF file) but also from distributed ones (e.g. ARFF folder). These last ones are managed using Flink. In code example shown below the model <em>Factor Analysis</em> is learnt from a distributed dataset.</p>
<pre><code>package eu.amidst.flinklink.examples.extensions;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.core.models.BayesianNetwork;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.io.DataFlinkLoader;
import eu.amidst.latentvariablemodels.staticmodels.FactorAnalysis;
import eu.amidst.latentvariablemodels.staticmodels.Model;
import org.apache.flink.api.java.ExecutionEnvironment;

import java.io.FileNotFoundException;

/**
 * Created by rcabanas on 14/06/16.
 */
public class LatentModelsFlink {
    public static void main(String[] args) throws FileNotFoundException {

        //Load the datastream
        String filename = &quot;datasets/simulated/exampleDS_d0_c5.arff&quot;;
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();
        DataFlink&lt;DataInstance&gt; data = DataFlinkLoader.loadDataFromFile(env, filename, false);

        //Learn the model
        Model model = new FactorAnalysis(data.getAttributes());
        ((FactorAnalysis)model).setNumberOfLatentVariables(3);
        model.updateModel(data);
        BayesianNetwork bn = model.getModel();

        System.out.println(bn);

    }
}</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a> In previous example,</p>
<h3 id="sec:flinklink:ext:conceptdrift">Concept drift detection</h3>
<pre><code>/*
 *
 *
 *    Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.
 *    See the NOTICE file distributed with this work for additional information regarding copyright ownership.
 *    The ASF licenses this file to You under the Apache License, Version 2.0 (the &quot;License&quot;); you may not use
 *    this file except in compliance with the License.  You may obtain a copy of the License at
 *
 *            http://www.apache.org/licenses/LICENSE-2.0
 *
 *    Unless required by applicable law or agreed to in writing, software distributed under the License is
 *    distributed on an &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *    See the License for the specific language governing permissions and limitations under the License.
 *
 *
 */

package eu.amidst.flinklink.examples.reviewMeeting2015;

import eu.amidst.core.datastream.DataInstance;
import eu.amidst.flinklink.core.conceptdrift.IDAConceptDriftDetector;
import eu.amidst.flinklink.core.data.DataFlink;
import eu.amidst.flinklink.core.io.DataFlinkLoader;
import org.apache.flink.api.java.ExecutionEnvironment;

/**
 * Created by ana@cs.aau.dk on 18/01/16.
 */
public class ConceptDriftDetector {

    //public int NSETS = 15;


    public static void learnIDAConceptDriftDetector(int NSETS) throws Exception {
        final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

      //  DataFlink&lt;DataInstance&gt; data0 = DataFlinkLoader.loadDataFromFolder(env,
      //          &quot;hdfs:///tmp_conceptdrift_data0.arff&quot;, false);

          DataFlink&lt;DataInstance&gt; data0 = DataFlinkLoader.open(env,
                  &quot;./datasets/DriftSets/sea.arff&quot;, false);

        long start = System.nanoTime();
        IDAConceptDriftDetector learn = new IDAConceptDriftDetector();
        learn.setBatchSize(1000);
        learn.setClassIndex(3);
        learn.setAttributes(data0.getAttributes());
        learn.setNumberOfGlobalVars(1);
        learn.setTransitionVariance(0.1);
        learn.setSeed(0);

        learn.initLearning();
        double[] output = new double[NSETS];

        System.out.println(&quot;--------------- LEARNING DATA &quot; + 0 + &quot; --------------------------&quot;);
        double[] out = learn.updateModelWithNewTimeSlice(data0);
        //System.out.println(learn.getLearntDynamicBayesianNetwork());
        output[0] = out[0];

        for (int i = 1; i &lt; NSETS; i++) {
            System.out.println(&quot;--------------- LEARNING DATA &quot; + i + &quot; --------------------------&quot;);
            DataFlink&lt;DataInstance&gt; dataNew = DataFlinkLoader.open(env,
                    &quot;./datasets/DriftSets/sea.arff&quot;, false);
            out = learn.updateModelWithNewTimeSlice(dataNew);
            //System.out.println(learn.getLearntDynamicBayesianNetwork());
            output[i] = out[0];

        }
        long duration = (System.nanoTime() - start) / 1;
        double seconds = duration / 1000000000.0;

        System.out.println(&quot;Running time&quot; + seconds + &quot; seconds&quot;);

        //System.out.println(learn.getLearntDynamicBayesianNetwork());

        for (int i = 0; i &lt; NSETS; i++) {
            System.out.println(&quot;E(H_&quot;+i+&quot;) =\t&quot; + output[i]);
        }

    }

    public static void main(String[] args) throws Exception {

        int NSETS = Integer.parseInt(args[0]);

        learnIDAConceptDriftDetector(NSETS);
    }

}</code></pre>
<p><a href="#sec:flinklink">[Back to Top]</a></p>
  <footer  class="site-footer"> <span  class="site-footer-owner"><a  href="https://github.com/amidst/toolbox">AMIDST
            Toolbox 0.5.0</a> is maintained by <a  href="https://github.com/amidst">amidst</a>.</span>
        <span  class="site-footer-credits">This page was generated by <a  href="https://pages.github.com">GitHub
            Pages</a> using the <a  href="https://github.com/jasonlong/cayman-theme">Cayman
            theme</a> by <a  href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>
    <script  type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
    <script  type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-66233470-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>
  

</body></html>
